{
  "project": "test",
  "name": "heap_bloat",
  "checkId": "F004",
  "timestamptz": "2019-06-28 21:53:49.0+0000",
  "dependencies": {
    "null": "null"
  },
  "last_nodes_json": {
    "hosts": {
      "runner-72989761-project-9951336-concurrent-0": {
        "internal_alias": "node1",
        "index": "1",
        "role": "master",
        "role_change_detected_at": "never"
      }
    },
    "last_check": {
      "epoch": "1",
      "timestamptz": "2019-06-28 21:53:49.0+0000",
      "dir": "1_2019_06_28T21_53_19_+0000"
    }
  },
  "database": "dbname",
  "results": {
    "runner-72989761-project-9951336-concurrent-0": {
      "data": {
        "heap_bloat": {
          "t_with_bloat": {
            "num": 1,
            "is_na": "",
            "table_name": "t_with_bloat",
            "real_size": "69 MB",
            "extra_size_bytes": 36388864,
            "extra_ratio_percent": 50.1920903954802,
            "extra": "~35 MB (50.19%)",
            "bloat_size_bytes": 36388864,
            "bloat_ratio_percent": 50.1920903954802,
            "bloat_estimate": "~35 MB (50.19%)",
            "real_size_bytes": 72499200,
            "live_data_size": "~34 MB",
            "live_data_size_bytes": 36110336,
            "last_vaccuum": "2019-06-28 21:53:00",
            "fillfactor": 100,
            "overrided_settings": true,
            "bloat_ratio": 2.0077132486388387
          },
          "t_rar_q": {
            "num": 2,
            "is_na": "",
            "table_name": "t_rar_q",
            "real_size": "50 MB",
            "extra_size_bytes": 8192000,
            "extra_ratio_percent": 15.6568028808517,
            "extra": "~8000 kB (15.66%)",
            "bloat_size_bytes": 8192000,
            "bloat_ratio_percent": 15.6568028808517,
            "bloat_estimate": "~8000 kB (15.66%)",
            "real_size_bytes": 52322304,
            "live_data_size": "~42 MB",
            "live_data_size_bytes": 44130304,
            "last_vaccuum": "2019-06-28 21:53:01",
            "fillfactor": 100,
            "overrided_settings": false,
            "bloat_ratio": 1.185632077222944
          },
          "bloated": {
            "num": 3,
            "is_na": "",
            "table_name": "bloated",
            "real_size": "3544 kB",
            "extra_size_bytes": 1818624,
            "extra_ratio_percent": 50.1128668171558,
            "extra": "~1776 kB (50.11%)",
            "bloat_size_bytes": 1818624,
            "bloat_ratio_percent": 50.1128668171558,
            "bloat_estimate": "~1776 kB (50.11%)",
            "real_size_bytes": 3629056,
            "live_data_size": "~1768 kB",
            "live_data_size_bytes": 1810432,
            "last_vaccuum": "2019-06-28 21:52:59",
            "fillfactor": 100,
            "overrided_settings": false,
            "bloat_ratio": 2.004524886877828
          },
          "t_slw_q": {
            "num": 4,
            "is_na": "",
            "table_name": "t_slw_q",
            "real_size": "346 MB",
            "extra_size_bytes": 1417216,
            "extra_ratio_percent": 0.390978123305008,
            "extra": "~1384 kB (0.39%)",
            "bloat_size_bytes": 1417216,
            "bloat_ratio_percent": 0.390978123305008,
            "bloat_estimate": "~1384 kB (0.39%)",
            "real_size_bytes": 362479616,
            "live_data_size": "~344 MB",
            "live_data_size_bytes": 361062400,
            "last_vaccuum": "2019-06-28 21:52:59",
            "fillfactor": 100,
            "overrided_settings": false,
            "bloat_ratio": 1.0039251276233692
          },
          "t_red_fk_2": {
            "num": 5,
            "is_na": "",
            "table_name": "t_red_fk_2",
            "real_size": "42 MB",
            "extra_size_bytes": 155648,
            "extra_ratio_percent": 0.351461339252682,
            "extra": "~152 kB (0.35%)",
            "bloat_size_bytes": 155648,
            "bloat_ratio_percent": 0.351461339252682,
            "bloat_estimate": "~152 kB (0.35%)",
            "real_size_bytes": 44285952,
            "live_data_size": "~42 MB",
            "live_data_size_bytes": 44130304,
            "last_vaccuum": "2019-06-28 21:52:59",
            "fillfactor": 100,
            "overrided_settings": false,
            "bloat_ratio": 1.003527009467236
          },
          "t_with_unused_index": {
            "num": 6,
            "is_na": "",
            "table_name": "t_with_unused_index",
            "real_size": "35 MB",
            "extra_size_bytes": 139264,
            "extra_ratio_percent": 0.384180790960452,
            "extra": "~136 kB (0.38%)",
            "bloat_size_bytes": 139264,
            "bloat_ratio_percent": 0.384180790960452,
            "bloat_estimate": "~136 kB (0.38%)",
            "real_size_bytes": 36249600,
            "live_data_size": "~34 MB",
            "live_data_size_bytes": 36110336,
            "last_vaccuum": "2019-06-28 21:53:01",
            "fillfactor": 100,
            "overrided_settings": false,
            "bloat_ratio": 1.0038566243194191
          },
          "test_schema.t_with_invalid_index": {
            "num": 7,
            "is_na": "",
            "table_name": "test_schema.t_with_invalid_index",
            "real_size": "35 MB",
            "extra_size_bytes": 139264,
            "extra_ratio_percent": 0.384180790960452,
            "extra": "~136 kB (0.38%)",
            "bloat_size_bytes": 139264,
            "bloat_ratio_percent": 0.384180790960452,
            "bloat_estimate": "~136 kB (0.38%)",
            "real_size_bytes": 36249600,
            "live_data_size": "~34 MB",
            "live_data_size_bytes": 36110336,
            "last_vaccuum": "2019-06-28 21:52:59",
            "fillfactor": 100,
            "overrided_settings": false,
            "bloat_ratio": 1.0038566243194191
          },
          "t_with_redundant_ref_idx": {
            "num": 8,
            "is_na": "",
            "table_name": "t_with_redundant_ref_idx",
            "real_size": "35 MB",
            "extra_size_bytes": 139264,
            "extra_ratio_percent": 0.384180790960452,
            "extra": "~136 kB (0.38%)",
            "bloat_size_bytes": 139264,
            "bloat_ratio_percent": 0.384180790960452,
            "bloat_estimate": "~136 kB (0.38%)",
            "real_size_bytes": 36249600,
            "live_data_size": "~34 MB",
            "live_data_size_bytes": 36110336,
            "last_vaccuum": "2019-06-28 21:53:02",
            "fillfactor": 100,
            "overrided_settings": false,
            "bloat_ratio": 1.0038566243194191
          },
          "t_red_fk_1": {
            "num": 9,
            "is_na": "",
            "table_name": "t_red_fk_1",
            "real_size": "35 MB",
            "extra_size_bytes": 139264,
            "extra_ratio_percent": 0.384180790960452,
            "extra": "~136 kB (0.38%)",
            "bloat_size_bytes": 139264,
            "bloat_ratio_percent": 0.384180790960452,
            "bloat_estimate": "~136 kB (0.38%)",
            "real_size_bytes": 36249600,
            "live_data_size": "~34 MB",
            "live_data_size_bytes": 36110336,
            "last_vaccuum": "2019-06-28 21:52:59",
            "fillfactor": 100,
            "overrided_settings": false,
            "bloat_ratio": 1.0038566243194191
          },
          "exp_redundant.t_with_redundant_ref_idx": {
            "num": 10,
            "is_na": "",
            "table_name": "exp_redundant.t_with_redundant_ref_idx",
            "real_size": "35 MB",
            "extra_size_bytes": 139264,
            "extra_ratio_percent": 0.384180790960452,
            "extra": "~136 kB (0.38%)",
            "bloat_size_bytes": 139264,
            "bloat_ratio_percent": 0.384180790960452,
            "bloat_estimate": "~136 kB (0.38%)",
            "real_size_bytes": 36249600,
            "live_data_size": "~34 MB",
            "live_data_size_bytes": 36110336,
            "last_vaccuum": "2019-06-28 21:52:59",
            "fillfactor": 100,
            "overrided_settings": false,
            "bloat_ratio": 1.0038566243194191
          },
          "t_with_redundant_index": {
            "num": 11,
            "is_na": "",
            "table_name": "t_with_redundant_index",
            "real_size": "35 MB",
            "extra_size_bytes": 139264,
            "extra_ratio_percent": 0.384180790960452,
            "extra": "~136 kB (0.38%)",
            "bloat_size_bytes": 139264,
            "bloat_ratio_percent": 0.384180790960452,
            "bloat_estimate": "~136 kB (0.38%)",
            "real_size_bytes": 36249600,
            "live_data_size": "~34 MB",
            "live_data_size_bytes": 36110336,
            "last_vaccuum": "2019-06-28 21:53:02",
            "fillfactor": 100,
            "overrided_settings": false,
            "bloat_ratio": 1.0038566243194191
          },
          "t_with_redundant_idx": {
            "num": 12,
            "is_na": "",
            "table_name": "t_with_redundant_idx",
            "real_size": "50 MB",
            "extra_size_bytes": 24576,
            "extra_ratio_percent": 0.0470957613814757,
            "extra": "~24 kB (0.05%)",
            "bloat_size_bytes": 24576,
            "bloat_ratio_percent": 0.0470957613814757,
            "bloat_estimate": "~24 kB (0.05%)",
            "real_size_bytes": 52183040,
            "live_data_size": "~50 MB",
            "live_data_size_bytes": 52158464,
            "last_vaccuum": "2019-06-28 21:53:02",
            "fillfactor": 100,
            "overrided_settings": false,
            "bloat_ratio": 1.0004711795193968
          }
        },
        "heap_bloat_total": {
          "count": 12,
          "extra_size_bytes_sum": 48832512,
          "real_size_bytes_sum": 804896768,
          "bloat_size_bytes_sum": 48832512,
          "live_data_size_bytes_sum": 756064256,
          "bloat_ratio_percent_avg": 6.066928572882529,
          "bloat_ratio_avg": 1.0645877802216852
        },
        "overrided_settings_count": 1,
        "database_size_bytes": 1368715935
      },
      "nodes.json": {
        "hosts": {
          "runner-72989761-project-9951336-concurrent-0": {
            "internal_alias": "node1",
            "index": "1",
            "role": "master",
            "role_change_detected_at": "never"
          }
        },
        "last_check": {
          "epoch": "1",
          "timestamptz": "2019-06-28 21:53:49.0+0000",
          "dir": "1_2019_06_28T21_53_19_+0000"
        }
      }
    }
  },
  "processed": true,
  "conclusions": [
    {
      "Id": "F004_TOTAL_BLOAT_LOW",
      "Message": "The total table (heap) bloat estimate is quite low, just ~6.07% (~46.58 MiB). Hooray! Keep watching it though.  \n"
    },
    {
      "Id": "F004_BLOAT_WARNING",
      "Message": "[P2] There are 2 tables with size \u003e 1 MiB and table bloat estimate \u003e= 40% and \u003c 90%:  \n    - `t_with_bloat`: size 69.15 MiB, can be reduced 2.01 times, by ~34.71 MiB (~50%)  \n    - `bloated`: size 3.47 MiB, can be reduced 2.00 times, by ~1.74 MiB (~50%)  \n  \n"
    }
  ],
  "recommendations": [
    {
      "Id": "F004_BLOAT_WARNING",
      "Message": "[P2] To resolve the table bloat issue, do both of the following actions:  \n    - to prevent high level of bloat in the future, tune autovacuum: consider more aggressive autovacuum settings (see F001);  \n    - get rid of current table bloat using one of the approaches mentioned below.  \n"
    },
    {
      "Id": "F004_GENERAL_INFO",
      "Message": "If you want to get exact bloat numbers, clone the database, get table sizes, then apply `VACUUM FULL` and get new table sizes. This will give the most reliable numbers.  \n"
    },
    {
      "Id": "F004_GENERAL_INFO",
      "Message": "To reduce the table bloat, consider using one of the following:  \n    - [`VACUUM FULL`](https://www.postgresql.org/docs/current/sql-vacuum.html) (:warning:  requires downtime / maintenance window),  \n    - one of the tools reducing the bloat online, without interrupting the operations:  \n        - [pg_repack](https://github.com/reorg/pg_repack),  \n        - [pg_squeeze](https://github.com/reorg/pg_repack),  \n        - [pgcompacttable](https://github.com/dataegret/pgcompacttable).  \n"
    },
    {
      "Id": "F004_BLOAT_INFO",
      "Message": "Read more on this topic:  \n    - [Bloat estimation for tables](http://blog.ioguix.net/postgresql/2014/09/10/Bloat-estimation-for-tables.html) (2014, ioguix)  \n    - [Show database bloat](https://wiki.postgresql.org/wiki/Show_database_bloat) (PostgreSQL wiki)\n    - [PostgreSQL Bloat: origins, monitoring and managing](https://www.compose.com/articles/postgresql-bloat-origins-monitoring-and-managing/) (2016, Compose)  \n    - [Dealing with significant Postgres database bloat — what are your options?](https://medium.com/compass-true-north/dealing-with-significant-postgres-database-bloat-what-are-your-options-a6c1814a03a5) (2018, Compass)  \n    - [Postgres database bloat analysis](https://about.gitlab.com/handbook/engineering/infrastructure/blueprint/201901-postgres-bloat/) (2019, GitLab)  \n"
    }
  ],
  "p1": false,
  "p2": true,
  "p3": false
}