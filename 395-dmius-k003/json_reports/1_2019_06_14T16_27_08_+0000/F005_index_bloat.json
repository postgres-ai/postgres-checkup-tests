{
  "project": "test",
  "name": "index_bloat",
  "checkId": "F005",
  "timestamptz": "2019-06-14 16:27:37.0+0000",
  "dependencies": {
    "null": "null"
  },
  "last_nodes_json": {
    "hosts": {
      "runner-ed2dce3a-project-9951336-concurrent-0": {
        "internal_alias": "node1",
        "index": "1",
        "role": "master",
        "role_change_detected_at": "never"
      }
    },
    "last_check": {
      "epoch": "1",
      "timestamptz": "2019-06-14 16:27:37.0+0000",
      "dir": "1_2019_06_14T16_27_08_+0000"
    }
  },
  "database": "dbname",
  "results": {
    "runner-ed2dce3a-project-9951336-concurrent-0": {
      "data": {
        "index_bloat": {
          "t_rar_q_idx(t_rar_q)": {
            "num": 1,
            "is_na": "",
            "index_name": "t_rar_q_idx",
            "table_name": "t_rar_q",
            "index_table_name": "t_rar_q_idx(t_rar_q)",
            "real_size_bytes": 44941312,
            "size": "43 MB",
            "bloat_ratio": 2.0065837600585223,
            "extra_ratio_percent": 55.1768137076194,
            "extra": "~24 MB (55.18%)",
            "extra_size_bytes": 24797184,
            "bloat": "~22 MB (50.16%)",
            "bloat_size_bytes": 22544384,
            "bloat_ratio_percent": 50.1640539555232,
            "live_data_size": "~21 MB",
            "live_data_size_bytes": 22396928,
            "live_bytes": 22396928,
            "fillfactor": 90,
            "overrided_settings": false,
            "table_size_bytes": 52371456
          },
          "i_bloated(bloated)": {
            "num": 2,
            "is_na": "",
            "index_name": "i_bloated",
            "table_name": "bloated",
            "index_table_name": "i_bloated(bloated)",
            "real_size_bytes": 2260992,
            "size": "2208 kB",
            "bloat_ratio": 2,
            "extra_ratio_percent": 55.0724637681159,
            "extra": "~1216 kB (55.07%)",
            "extra_size_bytes": 1245184,
            "bloat": "~1104 kB (50.00%)",
            "bloat_size_bytes": 1130496,
            "bloat_ratio_percent": 50,
            "live_data_size": "~1104 kB",
            "live_data_size_bytes": 1130496,
            "live_bytes": 1130496,
            "fillfactor": 90,
            "overrided_settings": false,
            "table_size_bytes": 3661824
          },
          "i_redundant_1(t_with_redundant_index)": {
            "num": 3,
            "is_na": "",
            "index_name": "i_redundant_1",
            "table_name": "t_with_redundant_index",
            "index_table_name": "i_redundant_1(t_with_redundant_index)",
            "real_size_bytes": 22487040,
            "size": "21 MB",
            "bloat_ratio": 1.0040234089246525,
            "extra_ratio_percent": 10.4189435336976,
            "extra": "~2288 kB (10.42%)",
            "extra_size_bytes": 2342912,
            "bloat": "~88 kB (0.40%)",
            "bloat_size_bytes": 90112,
            "bloat_ratio_percent": 0.400728597449909,
            "live_data_size": "~21 MB",
            "live_data_size_bytes": 22396928,
            "live_bytes": 22396928,
            "fillfactor": 90,
            "overrided_settings": false,
            "table_size_bytes": 36290560
          },
          "i_redundant_2(t_with_redundant_index)": {
            "num": 4,
            "is_na": "",
            "index_name": "i_redundant_2",
            "table_name": "t_with_redundant_index",
            "index_table_name": "i_redundant_2(t_with_redundant_index)",
            "real_size_bytes": 22487040,
            "size": "21 MB",
            "bloat_ratio": 1.0040234089246525,
            "extra_ratio_percent": 10.4189435336976,
            "extra": "~2288 kB (10.42%)",
            "extra_size_bytes": 2342912,
            "bloat": "~88 kB (0.40%)",
            "bloat_size_bytes": 90112,
            "bloat_ratio_percent": 0.400728597449909,
            "live_data_size": "~21 MB",
            "live_data_size_bytes": 22396928,
            "live_bytes": 22396928,
            "fillfactor": 90,
            "overrided_settings": false,
            "table_size_bytes": 36290560
          },
          "t_with_redundant_idx_f1_f2(t_with_redundant_idx)": {
            "num": 5,
            "is_na": "",
            "index_name": "t_with_redundant_idx_f1_f2",
            "table_name": "t_with_redundant_idx",
            "index_table_name": "t_with_redundant_idx_f1_f2(t_with_redundant_idx)",
            "real_size_bytes": 22487040,
            "size": "21 MB",
            "bloat_ratio": 1.0040234089246525,
            "extra_ratio_percent": 10.4189435336976,
            "extra": "~2288 kB (10.42%)",
            "extra_size_bytes": 2342912,
            "bloat": "~88 kB (0.40%)",
            "bloat_size_bytes": 90112,
            "bloat_ratio_percent": 0.400728597449909,
            "live_data_size": "~21 MB",
            "live_data_size_bytes": 22396928,
            "live_bytes": 22396928,
            "fillfactor": 90,
            "overrided_settings": false,
            "table_size_bytes": 52224000
          },
          "t_with_redundant_idx_id(t_with_redundant_idx)": {
            "num": 6,
            "is_na": "",
            "index_name": "t_with_redundant_idx_id",
            "table_name": "t_with_redundant_idx",
            "index_table_name": "t_with_redundant_idx_id(t_with_redundant_idx)",
            "real_size_bytes": 22487040,
            "size": "21 MB",
            "bloat_ratio": 1.0040234089246525,
            "extra_ratio_percent": 10.4189435336976,
            "extra": "~2288 kB (10.42%)",
            "extra_size_bytes": 2342912,
            "bloat": "~88 kB (0.40%)",
            "bloat_size_bytes": 90112,
            "bloat_ratio_percent": 0.400728597449909,
            "live_data_size": "~21 MB",
            "live_data_size_bytes": 22396928,
            "live_bytes": 22396928,
            "fillfactor": 90,
            "overrided_settings": false,
            "table_size_bytes": 52224000
          },
          "t_with_redundant_idx_pkey(t_with_redundant_idx)": {
            "num": 7,
            "is_na": "",
            "index_name": "t_with_redundant_idx_pkey",
            "table_name": "t_with_redundant_idx",
            "index_table_name": "t_with_redundant_idx_pkey(t_with_redundant_idx)",
            "real_size_bytes": 22487040,
            "size": "21 MB",
            "bloat_ratio": 1.0040234089246525,
            "extra_ratio_percent": 10.4189435336976,
            "extra": "~2288 kB (10.42%)",
            "extra_size_bytes": 2342912,
            "bloat": "~88 kB (0.40%)",
            "bloat_size_bytes": 90112,
            "bloat_ratio_percent": 0.400728597449909,
            "live_data_size": "~21 MB",
            "live_data_size_bytes": 22396928,
            "live_bytes": 22396928,
            "fillfactor": 90,
            "overrided_settings": false,
            "table_size_bytes": 52224000
          },
          "t_with_redundant_ref_idx_1(t_with_redundant_ref_idx)": {
            "num": 8,
            "is_na": "",
            "index_name": "t_with_redundant_ref_idx_1",
            "table_name": "t_with_redundant_ref_idx",
            "index_table_name": "t_with_redundant_ref_idx_1(t_with_redundant_ref_idx)",
            "real_size_bytes": 22487040,
            "size": "21 MB",
            "bloat_ratio": 1.0040234089246525,
            "extra_ratio_percent": 10.4189435336976,
            "extra": "~2288 kB (10.42%)",
            "extra_size_bytes": 2342912,
            "bloat": "~88 kB (0.40%)",
            "bloat_size_bytes": 90112,
            "bloat_ratio_percent": 0.400728597449909,
            "live_data_size": "~21 MB",
            "live_data_size_bytes": 22396928,
            "live_bytes": 22396928,
            "fillfactor": 90,
            "overrided_settings": false,
            "table_size_bytes": 36290560
          },
          "t_with_redundant_ref_idx_2(t_with_redundant_ref_idx)": {
            "num": 9,
            "is_na": "",
            "index_name": "t_with_redundant_ref_idx_2",
            "table_name": "t_with_redundant_ref_idx",
            "index_table_name": "t_with_redundant_ref_idx_2(t_with_redundant_ref_idx)",
            "real_size_bytes": 22487040,
            "size": "21 MB",
            "bloat_ratio": 1.0040234089246525,
            "extra_ratio_percent": 10.4189435336976,
            "extra": "~2288 kB (10.42%)",
            "extra_size_bytes": 2342912,
            "bloat": "~88 kB (0.40%)",
            "bloat_size_bytes": 90112,
            "bloat_ratio_percent": 0.400728597449909,
            "live_data_size": "~21 MB",
            "live_data_size_bytes": 22396928,
            "live_bytes": 22396928,
            "fillfactor": 90,
            "overrided_settings": false,
            "table_size_bytes": 36290560
          },
          "t_with_redundant_ref_idx_3(t_with_redundant_ref_idx)": {
            "num": 10,
            "is_na": "",
            "index_name": "t_with_redundant_ref_idx_3",
            "table_name": "t_with_redundant_ref_idx",
            "index_table_name": "t_with_redundant_ref_idx_3(t_with_redundant_ref_idx)",
            "real_size_bytes": 22487040,
            "size": "21 MB",
            "bloat_ratio": 1.0040234089246525,
            "extra_ratio_percent": 10.4189435336976,
            "extra": "~2288 kB (10.42%)",
            "extra_size_bytes": 2342912,
            "bloat": "~88 kB (0.40%)",
            "bloat_size_bytes": 90112,
            "bloat_ratio_percent": 0.400728597449909,
            "live_data_size": "~21 MB",
            "live_data_size_bytes": 22396928,
            "live_bytes": 22396928,
            "fillfactor": 90,
            "overrided_settings": false,
            "table_size_bytes": 36290560
          },
          "t_with_redundant_ref_idx_1(exp_redundant.t_with_redundant_ref_idx)": {
            "num": 11,
            "is_na": "",
            "index_name": "t_with_redundant_ref_idx_1",
            "table_name": "exp_redundant.t_with_redundant_ref_idx",
            "index_table_name": "t_with_redundant_ref_idx_1(exp_redundant.t_with_redundant_ref_idx)",
            "real_size_bytes": 22487040,
            "size": "21 MB",
            "bloat_ratio": 1.0040234089246525,
            "extra_ratio_percent": 10.4189435336976,
            "extra": "~2288 kB (10.42%)",
            "extra_size_bytes": 2342912,
            "bloat": "~88 kB (0.40%)",
            "bloat_size_bytes": 90112,
            "bloat_ratio_percent": 0.400728597449909,
            "live_data_size": "~21 MB",
            "live_data_size_bytes": 22396928,
            "live_bytes": 22396928,
            "fillfactor": 90,
            "overrided_settings": false,
            "table_size_bytes": 36290560
          },
          "t_with_redundant_ref_idx_2(exp_redundant.t_with_redundant_ref_idx)": {
            "num": 12,
            "is_na": "",
            "index_name": "t_with_redundant_ref_idx_2",
            "table_name": "exp_redundant.t_with_redundant_ref_idx",
            "index_table_name": "t_with_redundant_ref_idx_2(exp_redundant.t_with_redundant_ref_idx)",
            "real_size_bytes": 22487040,
            "size": "21 MB",
            "bloat_ratio": 1.0040234089246525,
            "extra_ratio_percent": 10.4189435336976,
            "extra": "~2288 kB (10.42%)",
            "extra_size_bytes": 2342912,
            "bloat": "~88 kB (0.40%)",
            "bloat_size_bytes": 90112,
            "bloat_ratio_percent": 0.400728597449909,
            "live_data_size": "~21 MB",
            "live_data_size_bytes": 22396928,
            "live_bytes": 22396928,
            "fillfactor": 90,
            "overrided_settings": false,
            "table_size_bytes": 36290560
          },
          "t_with_redundant_ref_idx_3(exp_redundant.t_with_redundant_ref_idx)": {
            "num": 13,
            "is_na": "",
            "index_name": "t_with_redundant_ref_idx_3",
            "table_name": "exp_redundant.t_with_redundant_ref_idx",
            "index_table_name": "t_with_redundant_ref_idx_3(exp_redundant.t_with_redundant_ref_idx)",
            "real_size_bytes": 22487040,
            "size": "21 MB",
            "bloat_ratio": 1.0040234089246525,
            "extra_ratio_percent": 10.4189435336976,
            "extra": "~2288 kB (10.42%)",
            "extra_size_bytes": 2342912,
            "bloat": "~88 kB (0.40%)",
            "bloat_size_bytes": 90112,
            "bloat_ratio_percent": 0.400728597449909,
            "live_data_size": "~21 MB",
            "live_data_size_bytes": 22396928,
            "live_bytes": 22396928,
            "fillfactor": 90,
            "overrided_settings": false,
            "table_size_bytes": 36290560
          },
          "r_red_fk_1_id_idx(t_red_fk_1)": {
            "num": 14,
            "is_na": "",
            "index_name": "r_red_fk_1_id_idx",
            "table_name": "t_red_fk_1",
            "index_table_name": "r_red_fk_1_id_idx(t_red_fk_1)",
            "real_size_bytes": 22487040,
            "size": "21 MB",
            "bloat_ratio": 1.0040234089246525,
            "extra_ratio_percent": 10.4189435336976,
            "extra": "~2288 kB (10.42%)",
            "extra_size_bytes": 2342912,
            "bloat": "~88 kB (0.40%)",
            "bloat_size_bytes": 90112,
            "bloat_ratio_percent": 0.400728597449909,
            "live_data_size": "~21 MB",
            "live_data_size_bytes": 22396928,
            "live_bytes": 22396928,
            "fillfactor": 90,
            "overrided_settings": false,
            "table_size_bytes": 36290560
          },
          "r_red_fk_1_x_idx(t_red_fk_1)": {
            "num": 15,
            "is_na": "",
            "index_name": "r_red_fk_1_x_idx",
            "table_name": "t_red_fk_1",
            "index_table_name": "r_red_fk_1_x_idx(t_red_fk_1)",
            "real_size_bytes": 22487040,
            "size": "21 MB",
            "bloat_ratio": 1.0040234089246525,
            "extra_ratio_percent": 10.4189435336976,
            "extra": "~2288 kB (10.42%)",
            "extra_size_bytes": 2342912,
            "bloat": "~88 kB (0.40%)",
            "bloat_size_bytes": 90112,
            "bloat_ratio_percent": 0.400728597449909,
            "live_data_size": "~21 MB",
            "live_data_size_bytes": 22396928,
            "live_bytes": 22396928,
            "fillfactor": 90,
            "overrided_settings": false,
            "table_size_bytes": 36290560
          },
          "t_red_fk_1_pkey(t_red_fk_1)": {
            "num": 16,
            "is_na": "",
            "index_name": "t_red_fk_1_pkey",
            "table_name": "t_red_fk_1",
            "index_table_name": "t_red_fk_1_pkey(t_red_fk_1)",
            "real_size_bytes": 22487040,
            "size": "21 MB",
            "bloat_ratio": 1.0040234089246525,
            "extra_ratio_percent": 10.4189435336976,
            "extra": "~2288 kB (10.42%)",
            "extra_size_bytes": 2342912,
            "bloat": "~88 kB (0.40%)",
            "bloat_size_bytes": 90112,
            "bloat_ratio_percent": 0.400728597449909,
            "live_data_size": "~21 MB",
            "live_data_size_bytes": 22396928,
            "live_bytes": 22396928,
            "fillfactor": 90,
            "overrided_settings": false,
            "table_size_bytes": 36290560
          },
          "i_unused(t_with_unused_index)": {
            "num": 17,
            "is_na": "",
            "index_name": "i_unused",
            "table_name": "t_with_unused_index",
            "index_table_name": "i_unused(t_with_unused_index)",
            "real_size_bytes": 22487040,
            "size": "21 MB",
            "bloat_ratio": 1.0040234089246525,
            "extra_ratio_percent": 10.4189435336976,
            "extra": "~2288 kB (10.42%)",
            "extra_size_bytes": 2342912,
            "bloat": "~88 kB (0.40%)",
            "bloat_size_bytes": 90112,
            "bloat_ratio_percent": 0.400728597449909,
            "live_data_size": "~21 MB",
            "live_data_size_bytes": 22396928,
            "live_bytes": 22396928,
            "fillfactor": 90,
            "overrided_settings": false,
            "table_size_bytes": 36290560
          }
        },
        "index_bloat_total": {
          "count": 17,
          "extra_size_bytes_sum": 61186048,
          "real_size_bytes_sum": 384507904,
          "bloat_size_bytes_sum": 25026560,
          "bloat_ratio_avg": 1.0696185224009844,
          "bloat_ratio_percent_avg": 6.508724460446982,
          "table_size_bytes_sum": 289710080,
          "live_data_size_bytes_sum": 359481344
        },
        "overrided_settings_count": 0,
        "database_size_bytes": 1368740511
      },
      "nodes.json": {
        "hosts": {
          "runner-ed2dce3a-project-9951336-concurrent-0": {
            "internal_alias": "node1",
            "index": "1",
            "role": "master",
            "role_change_detected_at": "never"
          }
        },
        "last_check": {
          "epoch": "1",
          "timestamptz": "2019-06-14 16:27:37.0+0000",
          "dir": "1_2019_06_14T16_27_08_+0000"
        }
      }
    }
  },
  "processed": true,
  "conclusions": [
    {
      "Id": "F005_TOTAL_BLOAT_LOW",
      "Message": "The total index bloat estimate is quite low, just ~6.51% (~23.87 MiB). Hooray! Keep watching it though."
    },
    {
      "Id": "F005_BLOAT_WARNING",
      "Message": "[P2] There are 2 indexes with size \u003e 1 MiB and index bloat estimate \u003e= 40% and \u003c 90%:  \n    - `t_rar_q_idx`: size 42.86 MiB, can be reduced 2.01 times, by ~23.65 MiB (~50%)  \n    - `i_bloated`: size 2.16 MiB, can be reduced 2.00 times, by ~1.19 MiB (~50%)  \n  \n"
    }
  ],
  "recommendations": [
    {
      "Id": "F005_BLOAT_WARNING",
      "Message": "[P2] Reduce and prevent high level of index bloat:  \n    - tune autovacuum: consider more aggressive autovacuum settings (See F001)  \n    - reduce index bloat using one of the approaches mentioned below.  \n"
    },
    {
      "Id": "F005_GENERAL_INFO",
      "Message": "If you want to get exact bloat numbers, clone the database, get index sizes, then apply `VACUUM FULL` and get new index sizes. This will give the most reliable numbers.  \n"
    },
    {
      "Id": "F005_GENERAL_INFO",
      "Message": "To reduce the index bloat, consider using one of the following:  \n    - [`VACUUM FULL`](https://www.postgresql.org/docs/current/sql-vacuum.html) (:warning:  requires downtime / maintenance window),  \n    - [`REINDEX`](https://www.postgresql.org/docs/current/sql-reindex.html) (`REINDEX INDEX`, `REINDEX TABLE`; :warning:  requires downtime / maintenance window),  \n    - recreating indexes online using `CREATE INDEX CONCURRENTLY`, `DROP INDEX CONCURRENTLY` and renaming (not trivial for indexes supporting PK, FK) // Postgres 12 also provides `REINDEX CONCURRENTLY`,  \n    - one of the tools reducing the bloat online, without interrupting the operations:  \n        - [pg_repack](https://github.com/reorg/pg_repack),  \n        - [pg_squeeze](https://github.com/reorg/pg_repack),  \n        - [pgcompacttable](https://github.com/dataegret/pgcompacttable).  \n"
    },
    {
      "Id": "F005_BLOAT_EXCESS_INFO",
      "Message": "Read more on this topic:  \n    - [Index maintenance](https://wiki.postgresql.org/wiki/Index_Maintenance) (PostgreSQL wiki)  \n    - [Btree bloat query](http://blog.ioguix.net/postgresql/2014/11/03/Btree-bloat-query-part-4.html) (2014, ioguix)  \n    - [PostgreSQL Index bloat under a microscope](http://pgeoghegan.blogspot.com/2017/07/postgresql-index-bloat-microscope.html) (2017, Peter Geoghegan)  \n    - [PostgreSQL Bloat: origins, monitoring and managing](https://www.compose.com/articles/postgresql-bloat-origins-monitoring-and-managing/) (2016, Compose)  \n    - [Dealing with significant Postgres database bloat — what are your options?](Dealing with significant Postgres database bloat — what are your options?) (2018, Compass)  \n    - [Postgres database bloat analysis](https://about.gitlab.com/handbook/engineering/infrastructure/blueprint/201901-postgres-bloat/) (2019, GitLab)  \n"
    }
  ],
  "p1": false,
  "p2": true,
  "p3": false
}